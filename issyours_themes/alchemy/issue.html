{% extends "base.html" %}

{% macro show_user(person) %}
    <span class="user">
        {{ person.nickname }}
        <div class="popover bs-popover-bottom">
            <h3 class="popover-header">{{ person.fullname or person.nickname }}</h3>
            <div class="popover-body"><a href="{{ person.original_url }}" target="_blank">Go to profile</a></div>
        </div>
    </span>
{% endmacro %}

{% macro show_date(dtime) %}
    <abbr title="{{ dtime.isoformat() }}">{{ local_date(dtime) }}</abbr>
{% endmacro %}

{% macro show_card(data, type) %}
    <div class="card mt-4">
        <div class="card-header text-secondary">
            {{ show_user(data.author) }}
            {{ 'submitted on' if type == 'issue' else 'commented on' }}
            {{ show_date(data.created_at) }}
            {% if data.author_role %}
            <span class="badge mt-1 float-right font-weight-normal">{{ data.author_role }}</span>
            {% endif %}
        </div>
        <div class="card-body">{{ data.body }}</div>
    </div>
{% endmacro %}

{% block title %}{{ issue.title|striptags }} {{ super() }}{% endblock %}

{% block page_header %}
    {{ issue.title }}
    <a href="{{ issue.original_url }}"><small>#{{ issue.slug }}</small></a>
{% endblock %}

{% block content %}
<section class="badges lead">
    <span class="badge text-uppercase badge-{{ 'danger' if issue.closed_at else 'success' }}">{{ issue.status }}</span>
    {% for label in issue.labels %}
    <span class="badge text-{{ 'white' if label.is_dark else 'black' }}" style="background: {{ label.color }}">{{ label.name }}</span>
    {% endfor %}
</section>
<section id="content" class="body">
    {{ show_card(issue, 'issue') }}
    {% for comment in issue.comments() %}
    {{ show_card(comment, 'comment') }}
    {% endfor %}
</section>
{% endblock %}
